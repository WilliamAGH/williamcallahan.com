graph LR
    %% Entry Points
    A["ğŸ’¾ Storage Request"] --> B{Operation Type?}
    
    %% Read Operations
    B -->|Read| C[Read Operations]
    C --> D{Content Type?}
    D -->|JSON| E["ğŸš« Bypass CDN - Direct S3"]
    D -->|Binary/Images| F{CDN Available?}
    
    F -->|âœ… Yes| G["ğŸš€ Try CDN First (~50ms)"]
    F -->|âŒ No| H["ğŸ“ Direct S3 (~100-200ms)"]
    
    G --> I{CDN Success?}
    I -->|âœ… Yes| J["Return CDN Data"]
    I -->|âŒ No| K["Fallback to S3"]
    
    %% S3 Operations (Peer Level)
    E --> L[S3Client.GetObjectCommand]
    H --> L
    K --> L
    L --> M["ğŸ“ Return S3 Data"]
    
    %% Write Operations (Parallel)
    B -->|Write| N[Write Operations]
    N --> O[JSON.stringify / Buffer Processing]
    O --> P[S3Client.PutObjectCommand]
    P --> Q[Public ACL for CDN Access]
    Q --> R["ğŸ’¾ S3 Upload (~200-500ms)"]
    
    %% Management Operations (Parallel)
    B -->|Management| S[Management Operations]
    S --> T[S3Client.ListObjectsCommand]
    S --> U[S3Client.DeleteObjectCommand]
    
    %% Storage Organization
    subgraph Storage ["ğŸ—‚ï¸ S3 Organization"]
        V["images/ - handled by image-handling"]
        W["opengraph/ - handled by image-handling & json-handling"]
        X["bookmarks/ - handled by json-handling"]
        Y["github/ - handled by json-handling"]
    end
    
    %% Critical Issues
    subgraph Issues ["ğŸš¨ Critical Issues"]
        AA["CDN Decision: Hardcoded by file extension"]
        BB["Error Handling: Limited S3 error coverage"]
        CC["Concurrency: Single S3Client bottleneck"]
    end
    
    style A fill:#e1f5fe
    style AA fill:#ffebee
    style BB fill:#ffebee
    style CC fill:#ffebee
    style J fill:#e8f5e8
    style M fill:#fff3e0
    style R fill:#fce4ec